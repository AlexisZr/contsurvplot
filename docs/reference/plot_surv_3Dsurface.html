<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Using a previously fit time-to-event model, this function plots the survival curve as a function of a continuous variable using a 3D surface representation. This function can produce interactive plots using the plotly package, or a static image using the persp function of the graphics package."><title>Plot the Survival Curve or CIF Dependent on a Continuous Variable as a 3D Surface — plot_surv_3Dsurface • contsurvplot</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot the Survival Curve or CIF Dependent on a Continuous Variable as a 3D Surface — plot_surv_3Dsurface"><meta property="og:description" content="Using a previously fit time-to-event model, this function plots the survival curve as a function of a continuous variable using a 3D surface representation. This function can produce interactive plots using the plotly package, or a static image using the persp function of the graphics package."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">contsurvplot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Visualizing the Causal Effect of a Continuous Variable on a Time-To-Event Outcome</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RobinDenz1/contsurvplot/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Plot the Survival Curve or CIF Dependent on a Continuous Variable as a 3D Surface</h1>
      
      <div class="d-none name"><code>plot_surv_3Dsurface.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Using a previously fit time-to-event model, this function plots the survival curve as a function of a continuous variable using a 3D surface representation. This function can produce interactive plots using the <span class="pkg">plotly</span> package, or a static image using the <code><a href="https://rdrr.io/r/graphics/graphics-package.html" class="external-link">persp</a></code> function of the <span class="pkg">graphics</span> package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">plot_surv_3Dsurface</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span>, <span class="va">variable</span>, <span class="va">data</span>, <span class="va">model</span>,
                    cif<span class="op">=</span><span class="cn">FALSE</span>, na.action<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">na.action</span>,
                    horizon<span class="op">=</span><span class="cn">NULL</span>, fixed_t<span class="op">=</span><span class="cn">NULL</span>, max_t<span class="op">=</span><span class="cn">Inf</span>,
                    interactive<span class="op">=</span><span class="cn">FALSE</span>,
                    xlab<span class="op">=</span><span class="st">"Time"</span>, ylab<span class="op">=</span><span class="st">"Survival Probability"</span>,
                    zlab<span class="op">=</span><span class="va">variable</span>, ticktype<span class="op">=</span><span class="st">"detailed"</span>,
                    theta<span class="op">=</span><span class="fl">120</span>, phi<span class="op">=</span><span class="fl">20</span>, col<span class="op">=</span><span class="st">"green"</span>, shade<span class="op">=</span><span class="fl">0.5</span>,
                    <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>time</dt>
<dd><p>A single character string specifying the time-to-event variable. Needs to be a valid column name of a numeric variable in <code>data</code>.</p></dd>
<dt>status</dt>
<dd><p>A single character string specifying the status variable, indicating if a person has experienced an event or not. Needs to be a valid column name of a numeric or logical variable in <code>data</code>.</p></dd>
<dt>variable</dt>
<dd><p>A single character string specifying the continuous variable of interest, for which the survival curves should be estimated. This variable has to be contained in the <code>data.frame</code> that is supplied to the <code>data</code> argument.</p></dd>
<dt>data</dt>
<dd><p>A <code>data.frame</code> containing all required variables.</p></dd>
<dt>model</dt>
<dd><p>A model describing the time-to-event process (such as an <code>coxph</code> model). Needs to include <code>variable</code> as an independent variable. It also has to have an associated <code><a href="https://rdrr.io/pkg/riskRegression/man/riskRegression.html" class="external-link">predictRisk</a></code> method. See <code><a href="https://rdrr.io/pkg/riskRegression/man/predictRisk.html" class="external-link">?predictRisk</a></code> for more details.</p></dd>
<dt>cif</dt>
<dd><p>Whether to plot the cumulative incidence (CIF) instead of the survival probability. If multiple failure types are present, the survival probability cannot be estimated in an unbiased way. This function will always return CIF estimates in that case.</p></dd>
<dt>na.action</dt>
<dd><p>How missing values should be handled. Can be one of: <code>na.fail</code>, <code>na.omit</code>, <code>na.pass</code>, <code>na.exclude</code> or a user-defined custom function. Also accepts strings of the function names. See <code><a href="https://rdrr.io/r/stats/na.action.html" class="external-link">?na.action</a></code> for more details. By default it uses the na.action which is set in the global options by the respective user.</p></dd>
<dt>horizon</dt>
<dd><p>A numeric vector containing a range of values of <code>variable</code> for which the survival curves should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the horizon is constructed as a sequence from the lowest to the highest value observed in <code>variable</code> with 40 equally spaced steps.</p></dd>
<dt>fixed_t</dt>
<dd><p>A numeric vector containing points in time at which the survival probabilities should be calculated or <code>NULL</code> (default). If <code>NULL</code>, the survival probability is estimated at every point in time at which an event occured.</p></dd>
<dt>max_t</dt>
<dd><p>A number indicating the latest survival time which is to be plotted.</p></dd>
<dt>interactive</dt>
<dd><p>Whether to draw the 3D surface as a static plot (<code>interactive=FALSE</code>, the default) or as an interactive plot. When <code>interactive=TRUE</code> is used, this function relies on the <span class="pkg">plotly</span> package. In this case, the only aesthetic arguments that still work are the <code>xlab</code>, <code>ylab</code> and <code>zlab</code> arguments. Everything else has to be set manually using the functionality of the <span class="pkg">plotly</span> package directly.</p></dd>
<dt>xlab</dt>
<dd><p>A character string used as the x-axis label of the plot, representing the survival time.</p></dd>
<dt>ylab</dt>
<dd><p>A character string used as the y-axis label of the plot, representing the survival probability or CIF.</p></dd>
<dt>zlab</dt>
<dd><p>A character string used as the z-axis of the plot, representing the continuous covariate of interest.</p></dd>
<dt>ticktype</dt>
<dd><p>A single character: <code>"simple"</code> draws just an arrow parallel to the axis to indicate direction of increase; <code>"detailed"</code> draws normal ticks as per 2D plots. Passed to the <code>ticktype</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.</p></dd>
<dt>theta</dt>
<dd><p>Angles defining the viewing direction. <code>theta</code> gives the azimuthal direction and <code>phi</code> the colatitude. Passed to the <code>theta</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.</p></dd>
<dt>phi</dt>
<dd><p>See argument <code>theta</code>. Passed to the <code>phi</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.</p></dd>
<dt>col</dt>
<dd><p>The color(s) of the surface facets. Transparent colours are ignored. This is recycled to the <code>(nx-1)(ny-1)</code> facets. Passed to the <code>col</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.</p></dd>
<dt>shade</dt>
<dd><p>The shade at a surface facet is computed as <code>((1+d)/2)^shade</code>, where d is the dot product of a unit vector normal to the facet and a unit vector in the direction of a light source. Values of shade close to one yield shading similar to a point light source model and values close to zero produce no shading. Values in the range 0.5 to 0.75 provide an approximation to daylight illumination. Passed to the <code>shade</code> argument in the <code>persp</code> function. Ignored if <code>interactive=TRUE</code>.</p></dd>
<dt>...</dt>
<dd><p>Further arguments passed to <code><a href="curve_cont.html">curve_cont</a></code>.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The survival curve or CIF dependent on a continuous variable can be viewed as a 3D surface. All other plots in this package try to visualize this surface by reducing it to two dimensions using color scales or summary statistics. This function on the other hand directly plots the 3D surface as such.</p>
<p>Although 3D plots are frowned upon by many scientists, it might be a good visualisation choice from time to time. Using the <code>interactive=TRUE</code> option makes the plot interactive, which lessens some of the valid criticism of 3D graphics. Similar looking plots for the same purpose but using a likelihood-ratio approach have been proposed in Smith et al. (2019).</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a <code>plotly</code> object if <code>interactive=TRUE</code> is used and a matrix when <code>interactive=FALSE</code> is used (still drawing the plot).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Smith, A. M.; Christodouleas, J. P. &amp; Hwang, W.-T. Understanding the Predictive Value of Continuous Markers for Censored Survival Data Using a Likelihood Ratio Approach BMC Medical Research Methodology, 2019, 19</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tagteam/riskRegression" class="external-link">riskRegression</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># using data from the survival package</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nafld</span>, package<span class="op">=</span><span class="st">"survival"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># fit cox-model with age</span></span>
<span class="r-in"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>, data<span class="op">=</span><span class="va">nafld1</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot effect of age on survival for ages 50 to 80</span></span>
<span class="r-in"><span class="fu">plot_surv_3Dsurface</span><span class="op">(</span>time<span class="op">=</span><span class="st">"futime"</span>,</span>
<span class="r-in">                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span class="r-in">                    variable<span class="op">=</span><span class="st">"age"</span>,</span>
<span class="r-in">                    data<span class="op">=</span><span class="va">nafld1</span>,</span>
<span class="r-in">                    model<span class="op">=</span><span class="va">model</span>,</span>
<span class="r-in">                    horizon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">80</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span class="r-in">                    interactive<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot effect of age on survival using an interactive plot for ages 50 to 80</span></span>
<span class="r-in"><span class="fu">plot_surv_3Dsurface</span><span class="op">(</span>time<span class="op">=</span><span class="st">"futime"</span>,</span>
<span class="r-in">                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span class="r-in">                    variable<span class="op">=</span><span class="st">"age"</span>,</span>
<span class="r-in">                    data<span class="op">=</span><span class="va">nafld1</span>,</span>
<span class="r-in">                    model<span class="op">=</span><span class="va">model</span>,</span>
<span class="r-in">                    horizon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">80</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span class="r-in">                    interactive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## showing non-linear effects</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># fit cox-model with bmi modeled using B-Splines,</span></span>
<span class="r-in"><span class="co"># adjusting for age and sex</span></span>
<span class="r-in"><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">male</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="va">bmi</span>, df<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span class="r-in">                data<span class="op">=</span><span class="va">nafld1</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot effect of bmi on survival using normal plot</span></span>
<span class="r-in"><span class="fu">plot_surv_3Dsurface</span><span class="op">(</span>time<span class="op">=</span><span class="st">"futime"</span>,</span>
<span class="r-in">                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span class="r-in">                    variable<span class="op">=</span><span class="st">"bmi"</span>,</span>
<span class="r-in">                    data<span class="op">=</span><span class="va">nafld1</span>,</span>
<span class="r-in">                    model<span class="op">=</span><span class="va">model2</span>,</span>
<span class="r-in">                    interactive<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot effect of bmi on survival using interactive plot</span></span>
<span class="r-in"><span class="fu">plot_surv_3Dsurface</span><span class="op">(</span>time<span class="op">=</span><span class="st">"futime"</span>,</span>
<span class="r-in">                    status<span class="op">=</span><span class="st">"status"</span>,</span>
<span class="r-in">                    variable<span class="op">=</span><span class="st">"bmi"</span>,</span>
<span class="r-in">                    data<span class="op">=</span><span class="va">nafld1</span>,</span>
<span class="r-in">                    model<span class="op">=</span><span class="va">model2</span>,</span>
<span class="r-in">                    interactive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer></div>

  

  

  </body></html>

